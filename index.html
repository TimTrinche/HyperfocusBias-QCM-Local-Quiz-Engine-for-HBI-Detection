<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Simulation QCM + LLM</title>
  <link rel="stylesheet" href="/static/style.css?v=10"/>
</head>
<body>
  <main id="app">

    <!-- Étape 1 : Intro + Consentement -->
    <section class="card step active" id="step-intro">
      <h1>Étude expérimentale — QCM & assistance LLM</h1>
      <p>
        Bienvenue ! Cette étude évalue l’impact d’un assistant LLM local sur des QCM (12 questions).
        Le tirage au sort déterminera si vous avez droit à l’assistant.
        Si autorisé, un second tirage choisira le modèle (parmi votre pool local).<br/>
        Tout est anonyme. Vos interactions (temps, changements de réponse, ordre de navigation, usage LLM) sont enregistrées
        pour une analyse scientifique. Vous pouvez quitter à tout moment.
      </p>
      <div class="consent-row">
        <input id="consent" type="checkbox"/>
        <label for="consent">
          Je consens à participer à l’étude (anonyme) conformément au droit français
          (RGPD, consentement éclairé, droit d’opposition et d’effacement).
        </label>
      </div>
      <button id="btn-to-profile" class="btn-rumba-light" disabled>Continuer</button>
      <div class="foot-note">Le bouton s’active une fois le consentement coché.</div>
    </section>

    <!-- Étape 2 : Profil & paramètres -->
    <section class="card step" id="step-profile">
      <h2>Profil & paramètres</h2>
      <div class="grid-3">
        <div class="field">
          <label>Thématique du QCM</label>
          <select id="qcm_type" class="pill-select">
            <option value="commerce">Commerce</option>
            <option value="immobilier">Immobilier</option>
            <option value="mathématiques">Mathématiques</option>
            <option value="culture générale">Culture générale</option>
          </select>
        </div>
        <div class="field">
          <label>Niveau d’étude</label>
          <select id="study_level" class="pill-select">
            <option>Licence</option>
            <option>Master</option>
            <option>Bac+2</option>
            <option>Doctorat</option>
          </select>
        </div>
        <div class="field">
          <label>Secteur d’étude / travail</label>
          <select id="sector" class="pill-select">
            <option>commerce</option>
            <option>immobilier</option>
            <option>sciences</option>
            <option>culture</option>
            <option>général</option>
          </select>
        </div>
      </div>
      <div class="profile-actions">
        <button id="btn-test-llm" class="btn-rumba-light outline">Tester LLM local</button>
        <button id="btn-start" class="btn-rumba-light">Débuter</button>
      </div>
      <div id="llm-ping-result" class="mono small"></div>
    </section>

    <!-- Étape 3 : Tirage au sort -->
    <section class="card step" id="step-random">
      <h2>Résultat du tirage</h2>
      <div class="coin-area">
        <div class="coin" id="coin"></div>
      </div>
      <div id="coin-info" class="center mono"></div>
      <div id="dice-area" class="dice-area hidden">
        <div class="dice" id="dice"></div>
      </div>
      <div id="dice-info" class="center mono"></div>
      <button id="btn-to-prediction" class="btn-rumba-light" disabled>Continuer</button>
      <div class="foot-note small muted center">
        Interprétation : Pile/Face ⇒ <b>LLM autorisé ou non</b>. Si autorisé, le dé indique <b>quel modèle</b> du pool est sélectionné.
      </div>
    </section>

    <!-- Étape 4 : Prédiction -->
    <section class="card step" id="step-predict">
      <h2>Votre prédiction (sur 12)</h2>
      <div class="predict-wrap">
        <input id="predict" type="range" min="0" max="12" step="1" value="6"/>
        <input id="predict-input" type="number" min="0" max="12" step="1" value="6" class="predict-input" />
        <div class="predict-value"><span id="predict-value">6</span> / 12</div>
      </div>
      <button id="btn-to-qcm" class="btn-rumba-light">Commencer le QCM</button>
    </section>

    <!-- Étape 5 : QCM -->
    <section class="card step" id="step-qcm">
      <h2>QCM (12 questions)</h2>
      <div id="qcm-list"></div>

      <div class="qcm-actions center">
        <button id="btn-finish" class="btn-rumba-light">Terminer la session</button>
      </div>

      <!-- LLM chat box (bas de page) -->
      <div id="llm-box" class="llm-box">
        <h3>Assistance LLM</h3>
        <div id="llm-model-note" class="mono small"></div>
        <textarea id="llm-input" placeholder="Posez votre question au modèle…"></textarea>
        <button id="btn-ask" class="btn-rumba-light">Envoyer</button>
        <div id="llm-status" class="mono small muted"></div>
        <div id="llm-output" class="llm-output"></div>
      </div>
    </section>

    <!-- Étape 6 : Résultats -->
    <section class="card step" id="step-results">
      <h2>Résultats</h2>
      <div id="result-summary" class="big"></div>
      <div class="foot-note">Merci pour votre participation. Vous pouvez fermer la fenêtre.</div>
    </section>

    <!-- Bouton flottant (fixé à l'écran) -->
    <button id="btn-float-ask" class="btn-rumba-light float-btn hidden">Demander à <span id="float-model"></span></button>

  </main>

  <script>
    window.APP_CFG = { coinDurationMs: 1800, diceDurationMs: 1400 };
  </script>
  <script src="/static/app.js?v=10"></script>
</body>
</html>
